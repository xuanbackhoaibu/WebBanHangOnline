@model WebBanHangOnline.Models.Product

@{
    ViewData["Title"] = "S·ª≠a s·∫£n ph·∫©m";
    Layout = "_AdminLayout";
}

<h2>‚úèÔ∏è S·ª≠a s·∫£n ph·∫©m</h2>

<form asp-area="Admin"
      asp-controller="Product"
      asp-action="Edit"
      method="post"
      enctype="multipart/form-data"
      onsubmit="return confirmSubmit();">

    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="ProductId" />

    <div class="text-danger mb-3" asp-validation-summary="ModelOnly"></div>

    <div class="mb-3">
        <label class="form-label">T√™n s·∫£n ph·∫©m</label>
        <input asp-for="Name" class="form-control" />
        <span class="text-danger" asp-validation-for="Name"></span>
    </div>

    <!-- Slug (readonly ƒë·ªÉ debug) -->
    <div class="mb-3">
        <label class="form-label">Slug (SEO)</label>
        <input asp-for="Slug" class="form-control" readonly />
    </div>

    <!-- Danh m·ª•c -->
    <div class="mb-3">
        <label class="form-label">Danh m·ª•c</label>
        <select asp-for="CategoryId" class="form-select">
            @foreach (var c in ViewBag.Categories)
            {
                <option value="@c.CategoryId" selected="@(c.CategoryId == Model.CategoryId)">
                    @c.Name
                </option>
            }
        </select>
        <span class="text-danger" asp-validation-for="CategoryId"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Gi√°</label>
        <input asp-for="Price"
               class="form-control"
               type="number"
               step="0.01"
               min="0"
               inputmode="decimal" />
        <span class="text-danger" asp-validation-for="Price"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">M√¥ t·∫£</label>
        <textarea asp-for="Description"
                  class="form-control"
                  rows="4"></textarea>
    </div>

    <div class="mb-3 form-check">
        <input asp-for="IsActive" class="form-check-input" />
        <label class="form-check-label">K√≠ch ho·∫°t</label>
    </div>

    <hr />

    <!-- Thumbnail hi·ªán t·∫°i -->
    @if (!string.IsNullOrEmpty(Model.Thumbnail) && Model.Thumbnail != "/images/no-image.png")
    {
        <div class="mb-3">
            <label class="form-label">·∫¢nh ƒë·∫°i di·ªán hi·ªán t·∫°i:</label>
            <br />
            <img src="@Model.Thumbnail"
                 class="img-thumbnail"
                 style="max-width:150px;" />
        </div>
    }

    <!-- Upload thumbnail m·ªõi -->
    <div class="mb-3">
        <label class="form-label">Thay ƒë·ªïi ·∫£nh ƒë·∫°i di·ªán</label>
        <input type="file"
               name="ThumbnailFile"
               class="form-control"
               accept="image/*"
               onchange="previewThumb(this)" />
        <img id="thumbPreview"
             class="img-thumbnail mt-2 d-none"
             style="max-width:150px;" />
    </div>

    <hr />

    <!-- ·∫¢nh ph·ª• hi·ªán t·∫°i -->
    @if (Model.Images != null && Model.Images.Any())
    {
        <div class="mb-3">
            <label class="form-label">
                ·∫¢nh ph·ª• hi·ªán t·∫°i (@Model.Images.Count() ·∫£nh):
            </label>

            <div class="d-flex flex-wrap">
                @foreach (var img in Model.Images)
                {
                    <div class="position-relative me-2 mb-2">
                        <img src="@img.ImageUrl"
                             class="img-thumbnail"
                             style="max-width:100px;" />

                        <input type="checkbox"
                               name="DeleteImageIds"
                               value="@img.Id"
                               class="form-check-input position-absolute top-0 start-0"
                               title="T√≠ch ƒë·ªÉ xo√° ·∫£nh n√†y"
                               onclick="confirmDeleteImage(this)" />
                    </div>
                }
            </div>

            <small class="text-muted">
                T√≠ch v√†o ·∫£nh mu·ªën xo√° khi c·∫≠p nh·∫≠t
            </small>
        </div>
    }

    <!-- Upload ·∫£nh ph·ª• m·ªõi -->
    <div class="mb-3">
        <label class="form-label">Th√™m ·∫£nh ph·ª• m·ªõi</label>
        <input type="file"
               name="ImageFiles"
               class="form-control"
               accept="image/*"
               multiple />
    </div>

    <button id="btnSave"
            type="submit"
            class="btn btn-success">
        üíæ C·∫≠p nh·∫≠t
    </button>

    <a asp-action="Index"
       class="btn btn-secondary ms-2">
        ‚Üê Quay l·∫°i
    </a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        function previewThumb(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.getElementById("thumbPreview");
                    img.src = e.target.result;
                    img.classList.remove("d-none");
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function confirmDeleteImage(checkbox) {
            if (checkbox.checked) {
                const ok = confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° ·∫£nh n√†y?");
                if (!ok) checkbox.checked = false;
            }
        }

        function confirmSubmit() {
            const ok = confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën c·∫≠p nh·∫≠t s·∫£n ph·∫©m?");
            if (ok) {
                const btn = document.getElementById("btnSave");
                btn.disabled = true;
                btn.innerText = "ƒêang l∆∞u...";
            }
            return ok;
        }
    </script>
}
