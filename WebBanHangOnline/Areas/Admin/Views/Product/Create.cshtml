@model WebBanHangOnline.Models.Product

@{
    ViewData["Title"] = "Th√™m s·∫£n ph·∫©m m·ªõi";
    Layout = "_AdminLayout";
}

<h2>‚ûï Th√™m s·∫£n ph·∫©m m·ªõi</h2>

<form asp-area="Admin"
      asp-controller="Product"
      asp-action="Create"
      method="post"
      enctype="multipart/form-data">

    @Html.AntiForgeryToken()

    <div class="text-danger mb-3" asp-validation-summary="ModelOnly"></div>

    <!-- üî• Hidden Slug (ƒë·ªÉ ModelState kh√¥ng l·ªói) -->
    <input asp-for="Slug" type="hidden" />

    <div class="mb-3">
        <label class="form-label">T√™n s·∫£n ph·∫©m</label>
        <input asp-for="Name" class="form-control" />
        <span class="text-danger" asp-validation-for="Name"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Danh m·ª•c</label>
        <select asp-for="CategoryId" class="form-select">
            <option value="0">-- Ch·ªçn danh m·ª•c --</option>
            @foreach (var c in ViewBag.Categories)
            {
                <option value="@c.CategoryId">@c.Name</option>
            }
        </select>
        <span class="text-danger" asp-validation-for="CategoryId"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Gi√°</label>
        <input asp-for="Price"
               class="form-control"
               type="number"
               step="0.01"
               min="0"
               inputmode="decimal" />
        <span class="text-danger" asp-validation-for="Price"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">M√¥ t·∫£</label>
        <textarea asp-for="Description" class="form-control" rows="4"></textarea>
    </div>

    <!-- Thumbnail -->
    <div class="mb-3">
        <label class="form-label">·∫¢nh ƒë·∫°i di·ªán</label>
        <input type="file"
               name="ThumbnailFile"
               class="form-control"
               accept="image/*"
               onchange="previewThumbnail(this)" />

        <img id="thumbPreview"
             src="/images/no-image.png"
             class="img-thumbnail mt-2"
             style="max-height: 200px;" />
    </div>

    <!-- Multiple Images -->
    <div class="mb-3">
        <label class="form-label">·∫¢nh s·∫£n ph·∫©m (nhi·ªÅu ·∫£nh)</label>
        <input type="file"
               name="ImageFiles"
               class="form-control"
               accept="image/*"
               multiple
               onchange="previewImages(this)" />

        <div id="imagesPreview" class="d-flex flex-wrap mt-2 gap-2"></div>
    </div>

    <div class="mb-3 form-check">
        <input asp-for="IsActive" class="form-check-input" />
        <label class="form-check-label">K√≠ch ho·∫°t s·∫£n ph·∫©m</label>
    </div>

    <button type="submit" class="btn btn-success">üíæ L∆∞u</button>
    <a asp-area="Admin"
       asp-controller="Product"
       asp-action="Index"
       class="btn btn-secondary ms-2">
        ‚Üê Quay l·∫°i
    </a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        function previewThumbnail(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById("thumbPreview").src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function previewImages(input) {
            const preview = document.getElementById("imagesPreview");
            preview.innerHTML = "";

            if (input.files) {
                Array.from(input.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = e => {
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        img.className = "img-thumbnail";
                        img.style.maxHeight = "120px";
                        img.style.marginRight = "5px";
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }
    </script>
}
